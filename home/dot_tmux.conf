set-option -g default-shell /bin/zsh

set -g default-terminal 'xterm-256color'
set -ga terminal-overrides ',*256col*:Tc'

# Change prefix to `C-q`
unbind C-b
set -g prefix C-q
bind-key q send-prefix

set -g status-style "bg=colour238"
set -g status-left "#[fg=colour255,bg=colour241]#{?client_prefix,#[reverse],} Session: #S "
set -g status-left-length 30
set -g status-right "%Y-%m-%d(%a) %H:%M"
setw -g window-status-format "#I: #(basename #{pane_current_path}) "
setw -g window-status-current-format "#[fg=colour255,bg=colour35] #I: #(basename #{pane_current_path}) "
set -g set-titles on
set -g set-titles-string "#T"

set-option -g mouse on
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'copy-mode -e'"

setw -g mode-keys vi

bind r source-file ~/.tmux.conf \; display "Config reloaded!"

bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R
bind -n M-, previous-window
bind -n M-. next-window

bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

bind | split-window -h -c '#{pane_current_path}'
bind - split-window -v -c '#{pane_current_path}'
bind ` split-window -p 20 -h
bind = split-window -p 15 -v

bind Space run-shell '\
  if echo "#{session_name}" | grep -q "^popup_"; then \
    tmux detach-client; \
  else \
    SESSION="popup_$(echo #{pane_current_path} | md5sum | cut -c1-8)"; \
    tmux has-session -t "$SESSION" 2>/dev/null || \
    tmux new-session -d -s "$SESSION" -c "#{pane_current_path}"; \
    tmux display-popup -w80% -h80% -E "tmux attach-session -t $SESSION"; \
  fi'
